ğŸ¾ å‰ç«¯æ¨¡å—åŒ–å’Œæ¨¡å—åŒ–è§„èŒƒå‘å±•

ğŸ•˜ 2019.10.30 ç”± hoanfirst ç¼–è¾‘

æ¨¡å—åŒ–ä¸»è¦åŒ…å«ä¸¤éƒ¨åˆ†å†…å®¹

1. æ¨¡å—åŒ–

2. æ¨¡å—åŒ–è§„èŒƒ


### ä¸€ã€ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–

å°†ä¸€ä¸ªå¤æ‚çš„ç¨‹åºä¾æ®ä¸€å®šè§„èŒƒå°è£…æˆå‡ ä¸ªæ–‡ä»¶ï¼Œå¹¶æ‰“åŒ…åœ¨ä¸€èµ·ã€‚

æ¨¡å—å†…éƒ¨çš„æ•°æ®/å®ç°æ˜¯ç§æœ‰çš„ï¼Œé€šè¿‡æš´éœ²ä¸€äº›æ¥å£ä¸å¤–éƒ¨å…¶ä»–æ¨¡å—è¿›è¡Œé€šä¿¡ã€‚


### äºŒã€æ¨¡å—åŒ–å‘å±•å†ç¨‹

Stage - 1 - æ–‡ä»¶åˆ’åˆ†æ–¹å¼

```

- stage-1
  - moduleA.js
  - moduleB.js
  - index.html

```

æœ€æ—©ï¼Œå„ä¸ªæ¨¡å—é€»è¾‘ä»£ç éƒ½æ˜¯å„è‡ªæ”¾åœ¨ä¸€ä¸ªjsé‡Œé¢ã€‚

moduleA.js

```javascript

function foo() {}

```

moduleB.js

```javascript

var data = 'b'

```

index.html

```html

<head>
  <script src="moduleA.js"></script>
  <script src="moduleB.js"></script>
  <script>
    foo();
    data = "c";
  </script>
</head>

```

å­˜åœ¨çš„é—®é¢˜ï¼š

```

1. æ¨¡å—ç›´æ¥åœ¨å…¨å±€å·¥ä½œï¼Œå¤§é‡æ¨¡å—æˆå‘˜æ±¡æŸ“å…¨å±€ä½œç”¨åŸŸ

2. æ²¡æœ‰ç§æœ‰ç©ºé—´ï¼Œæ¨¡å—æˆå‘˜å®¹æ˜“åœ¨å¤–éƒ¨è¢«è®¿é—®æˆ–ä¿®æ”¹

3. å®¹æ˜“å‡ºç°å‘½åå†²çª

4. æ— æ³•ç®¡ç†æ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»

5. åœ¨ç»´æŠ¤è¿‡ç¨‹ä¸­å¾ˆéš¾ç†æ¸…æ¯ä¸ªæˆå‘˜æ‰€å±çš„æ¨¡å—

```


Stage - 2 - å‘½åç©ºé—´æ–¹å¼

åæ¥ï¼Œå‡ºç°äº†ç®€å•çš„å‘½åç©ºé—´ï¼Œå³ namespaceã€‚çº¦å®šæ¯ä¸ªæ¨¡å—åªèƒ½æš´éœ²ä¸€ä¸ªå…¨å±€å¯¹è±¡ï¼Œæ‰€æœ‰æˆå‘˜éƒ½æŒ‚åœ¨åˆ°è¯¥å¯¹è±¡é‡Œã€‚


moduleA.js

```javascript

window.namespaceA = {}

```

moduleB.js

```javascript

window.namespaceB = {
  data: 'b';
}

```

æ”¹è¿›ï¼š

```

è§£å†³äº†å‘½åå†²çªçš„é—®é¢˜ã€‚

```


Stage - 3 - IIFE

æ¥ç€ï¼Œå‡ºç°äº† IIFE(Immediately Invoked Function Expression, ç«‹å³æ‰§è¡Œå‡½æ•°è¡¨è¾¾å¼)ã€‚åŸºäºç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œä¸ºæ¨¡å—æä¾›ä¸€ä¸ªç§æœ‰çš„ç©ºé—´ã€‚

moduleA.js

```javascript

;(function() {
  var data = 'a';
  
  function method () {
    console.log(data)
  }
  
  window.moduleA = {
    method: method
  }
})()

```

moduleB.js

```javascript

;(function() {
  var data = 'b';
  
  function method () {
    console.log(data)
  }
  
  window.moduleB = {
    method: method
  }
})()

```

index.html

ç§æœ‰æˆå‘˜ data åªèƒ½åœ¨æ¨¡å—å†…éƒ¨é€šè¿‡é—­åŒ…çš„æ–¹å¼æ¥è®¿é—®ã€‚

```html

<script src="moduleA.js"></script>
<script src="moduleB.js"></script>
<script>
  ModuleA.method();
  ModuleA.data; //undefined
</script>

```

æ”¹è¿›ï¼š

```

è§£å†³æ²¡æœ‰ç§æœ‰ç©ºé—´çš„é—®é¢˜ã€‚

```


Stage - 4 - IIFE ä¾èµ–å‚æ•°


æœ€åï¼Œåœ¨è‡ªæ‰§è¡ŒåŒ¿åå‡½æ•°æ¨¡å¼çš„åŸºç¡€ä¸Šï¼Œå¼•å…¥äº†ä¾èµ–ï¼Œè¿™å°±æ˜¯`æ¨¡å—æ¨¡å¼`ã€‚**æ¨¡å—æ¨¡å¼æ˜¯ç°ä»£æ¨¡å—å®ç°çš„åŸºçŸ³**ã€‚

```javascript

//é€šè¿‡å½¢å‚çš„å½¢å¼å¼•å…¥(æ³¨å…¥)ä¾èµ–

(function(window, $){
  var _private = 'safe var',
  var foo = function(){ console.log(_private); }
  
  window.module = { foo };
  
  $('body').css('background', 'red');
  
})(window, jQuery);

module.foo(); 

```


### ä¸‰ã€ä¸ºä»€ä¹ˆè¦ä½¿ç”¨æ¨¡å—åŒ–

- webåº”ç”¨è¶Šæ¥è¶Šå¤æ‚

- è§£è€¦æ€§éœ€æ±‚è¶Šæ¥è¶Šé«˜

- deployment(éƒ¨ç½²) wants optimized code in few HTTP calls

æ€»è€Œè¨€ä¹‹ï¼Œå¼•å…¥æ¨¡å—åŒ–æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š

- é¿å…å‘½åå†²çªï¼Œå‡å°‘å‘½åç©ºé—´æ±¡æŸ“

- æ”¯æŒæŒ‰éœ€åŠ è½½

- å¤ç”¨æ€§æ›´é«˜

- å¯ç»´æŠ¤æ€§æ›´é«˜


### å››ã€é¡µé¢å¼•å…¥æ¨¡å—å‡ºç°çš„é—®é¢˜

- æ¨¡å—è¿‡å¤šé€ æˆé¡µé¢è¯·æ±‚jsè¿‡å¤š

- ä¾èµ–æ¨¡ç³Šï¼Œæ¨¡å—å¼•å…¥é¡ºåºä¸å¯æ›´æ”¹

- éš¾ä»¥ç»´æŠ¤


### äº”ã€æ¨¡å—åŒ–è§„èŒƒ

æ­£å› ä¸ºåœ¨é¡µé¢å¼•å…¥å¤šä¸ªæ¨¡å—å­˜åœ¨çš„ä¸è¶³ï¼Œè¿˜éœ€è¦å¼•å…¥ä¸€ç§`æ¨¡å—åŒ–è§„èŒƒ`ã€‚

- CommonJS

```javascript

//æš´éœ²
module.exports = value;

exports.xxx = value;

```

```javascript

//å¼•å…¥
require(xxx)

```

CommonJSæ¨¡å—åŒ–è§„èŒƒåœ¨æœåŠ¡å™¨ç«¯å®ç°ä¸»è¦æœ‰NodeJSï¼Œåœ¨æµè§ˆå™¨ç«¯ä¸»è¦æ˜¯é€šè¿‡Browserifyå®ç°ï¼Œä¹Ÿç§°ä¸ºCommonJSçš„æµè§ˆå™¨ç«¯çš„æ‰“åŒ…å·¥å…·ã€‚å› ä¸ºåœ¨æœåŠ¡å™¨ç«¯æ¨¡å—åŠ è½½æ˜¯è¿è¡Œæ—¶**åŒæ­¥åŠ è½½**çš„ï¼Œè¿™ç§åŒæ­¥æœºåˆ¶åœ¨æµè§ˆå™¨ç«¯ç”¨æˆ·ä½“éªŒæ˜¯å¾ˆä¸å‹å¥½çš„ï¼Œå› æ­¤åœ¨æµè§ˆå™¨ç«¯æ¨¡å—ä¸€èˆ¬éœ€è¦æå‰ç¼–è¯‘æ‰“åŒ…å¤„ç†ã€‚

- AMD

AMDï¼ŒAsynchronous Module Definitionæ¨¡å—åŒ–è§„èŒƒä¸“é—¨ç”¨äºæµè§ˆå™¨ç«¯ï¼Œæ¨¡å—çš„åŠ è½½æ˜¯å¼‚æ­¥çš„ã€‚

```javascript

//æš´éœ²æ¨¡å—

define(function(){
  return ...
})

define(['module1', 'module2'], function(m1, m2) {
  return ...
})

```

```javascript

//å¼•å…¥æ¨¡å—

require([''module1, 'module2'], function(m1, m2) {
  ...
})

```

AMDå®ç°ï¼ŒRequireJS(a js file and module loader)ã€‚

```javascript

//app.js
(function() {
  requirejs.config({
    baseUrl: 'js/', //åŸºæœ¬è·¯å¾„ï¼Œå‡ºå‘ç‚¹åœ¨æ ¹ç›®å½•ä¸‹
    paths: { //é…ç½®æ¨¡å—è·¯å¾„
        app: './app',
        other: './modules/other',
        jquery: './lib/jquery-1.10.1'
    }
  })
  
  requirejs(['jquery', 'canvas', 'app/sub'], function($, canvas, sub){
    //loaded and can be used here now.
  }) 
})();

```

- ES6

ES2015+å¼•å…¥çš„æ¨¡å—åŒ–è§„èŒƒã€‚

ä¾èµ–æ¨¡å—çš„è¿‡ç¨‹åŒCommonJSåœ¨æµè§ˆå™¨ç«¯ä¸€æ ·éœ€è¦ç¼–è¯‘æ‰“åŒ…å¤„ç†ã€‚

å› ä¸ºES6åœ¨ä¸€äº›æµè§ˆå™¨è¿˜ä¸æ”¯æŒï¼Œéœ€è¦ä½¿ç”¨babelè½¬åŒ–æˆES5ï¼Œè€ŒES5çš„`export`ã€`require`è¿˜éœ€è¦ç”¨ä¸Šé¢æåˆ°çš„`Browserify`æ¥æ”¯æŒã€‚

1. å®‰è£…ï¼š

```bash

npm i babel-cli -g //cli: command line interface. babel-cliæ”¯æŒç›´æ¥ä½¿ç”¨babelçš„å‘½ä»¤

npm i browserify -g

npm i babel-preset-es2015 --save-dev //å°†es6è½¬åŒ–æˆes5çš„å·¥å…·éƒ½ä¸‹è½½å¥½

```

2. babelrc and Browserifyï¼š


```json

//rc: run control
{
  'presets': ['es2015', 'react']
}

```

```bash

//run
babel js/src -d js/lib

browserify js/lib/app.js -o js/lib/bundle.js

```

3. è¯­æ³•

```javascript

//åˆ†åˆ«æš´éœ²(å¸¸è§„æš´éœ²)
export function foo() {}
export function bar() {} 
export let arr = []
 
//ç»Ÿä¸€æš´éœ²(å¸¸è§„æš´éœ²)
function fun1() {}
function fun2() {} 
export { fun1, fun2 };

//å¼•å…¥å¸¸è§„æš´éœ²éœ€è¦ä½¿ç”¨è§£æ„èµ‹å€¼
import { foo, bar } from './module1';
import { fun1, fun2 } from './module2'; 

//(é»˜è®¤æš´éœ²)
export default fun;

//å¼•å…¥é»˜è®¤æš´éœ²
import xxx from './module2'

```

