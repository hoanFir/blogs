### 防止服务器宕机停止服务

1. 启动/停止服务的脚本

实现一个Node服务，并且要作为生产环境，也就是正式环境，意味着它会和其他后台进程，如sshd、apache、mysql等一样使用，例如启动服务/停止服务等。但是，Node项目其实并没有为任何操作系统提供这些脚本。

在传统的方式中，通过使用init守护进程管理后台进程，其是通过调用/etc/init.d目录下的脚本实现的，比如Fedora和Redhat就是使用了这个进程。

2. 可靠性、易于管理、直观等

对于一个Web服务，还需要做到可靠，例如在崩溃时能做到自动重启；易于管理，即和系统管理实践结合得很好；直观，例如将过程结果记录到记录文件中。

**因此，想要基于Node实现一个完整的服务器，意味着我们需要综合操作系统本身的后台进程管理服务，实现需要的记录功能，实施安全措施或防御措施来对抗不良行为，比如阻断来自外网的服务攻击等。**

3. 方式

下面是一些不同平台上将Node作为后台守护进程执行的方式：

```

nodejs-autorestart：通过Upstart（Ubuntu、Debian等系统上）管理Linux上的Node实例

fugue：实现监听Node服务器，在崩溃时重启

forever：小型的命令行Node脚本，用于确保一个脚本能持续运行，即可以管理后台进程，在进程崩溃时重启进程，传递标准输出和错误流到记录文件离

Node-init：Node脚本，支持将Node应用转换成符合LSB（Linux兼容性的规范之一）的启动脚本

launchtool：Debian系统上的一个系统级命令，用于监听任一命令的启动，包括将其作为一个守护进程运行

Upstart：Ubuntu系统上单独使用该工具，或和monit一起使用管理Node服务器

launchd：一个在Mac OS X系统上运行的脚本



```




### 利用系统的多核能力

我们都知道，V8是一个单线程的JavaScript引擎，对于浏览器来说已经足够了，但是如果是在服务器上使用基于Node开发的应用，就只会使用多核中的一个CPU。

一个单线程进程，只能使用一个CPU，这就是事实。Node是“没有线程概念”的平台，虽然这让编程变得简单，但这也意味着其不能将多核系统利用起来。现在有很多项目正在努力实现多线程Node，同时希望将多核系统的硬件性能都发挥出来。

方案？

1. 最基础的想法

启动多个Node进程，在进程共享请求通信量。使用多个单线程进程可以充分利用所有的CPU。

[Cluster](https://github.com/ LearnBoost/cluster)
是多线程Node服务项目中的一个，它被称为“为Node设计的、可扩展的多核服务器管理器”，它会启动一系列可配置的子进程，在进程崩溃时重启它们，并拥有可扩展的记录功能、命令控制模块和统计功能。











