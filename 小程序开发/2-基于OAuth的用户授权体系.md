


## 一、OAuth

小程序和微信是一种类似应用与平台的关系，小程序属于微信公众平台，同一个平台下还有微信公众号：在技术角度上，小程序与微信的关系比公众号更密切，因为公众号的文章本质上是一个 H5 网页，对微信底层的依赖比小程序弱；从产品角度上，二者与微信的关系一致，都是运行在微信平台上的第三方应用。

既然小程序是微信平台的第三方应用，那么在接入微信登录时就要严格遵守官方的接入规范。**而在互联网技术领域，对于支持第三方应用接入的平台，在登录授权上有一套标准的技术规范：OAuth 2.0**。

关于OAuth/OAuth2.0，可通过阅读[OAutho原理](https://github.com/hoanFir/blogs/blob/master/%E5%B7%A5%E7%A8%8B/OAuth%E5%8E%9F%E7%90%86.md)学习。

> OAuth2.0解决了一个问题：小A向小B借了东西忘了还，某天小B着急要用，但是小A不在家，但好在小A家的门锁是智能门锁，可以将密码告诉小B让他自己去小A=家里取。但是小A本着“防人之心不可无”的心理，担心小B是否会趁机记下甚至修改你家的门锁密码。左右为难的时候，小A突然想起来智能门锁可以创建临时密码，这种临时密码只能在 10 分钟之内有效，而且没有修改原本密码的权限。这样就解决了被其他人入室的安全问题。简单概括就是：OAuth 2.0是一个授权机制，资源所有者告诉认证服务器，临时授予某个第三方应用访问资源服务器获取资源的权限，认证服务器给第三方应用颁发一个临时令牌，拥有这个令牌便可以获取资源数据，一旦令牌过期或失效便收回权限。



## 二、小程序登录流程

OAuth 2.0 规范中的令牌，与**小程序登录场景下的 token**作用是一致的，只不过 OAuth 规范只定义了令牌的作用，并没有限制它的具体使用方法，那微信（认证服务器）是怎么实现让用户（资源所有者）授权后使得微信小程序（第三方应用）可以访问用户放在微信服务器（资源服务器）上的用户信息呢？即微信遵循 OAuth 规范前提下的具体实践是什么？

### 2.1 如何搭建微信小程序的登录流程？

我们认为以微信为宿主的小程序使用微信登录是一件理所当然的事儿，但其实小程序并没有强制要求只能使用微信登录，你完全可以跟 Web 网站一样使用用户名、邮箱等登录方式。既然如此，为什么我们一定要使用微信登录呢？因为除了便利性以外，微信登录更重要的优势是整合了微信庞大的生态系统，以及对于产品策略的加持。
