


## 一、OAuth

小程序和微信是一种类似应用与平台的关系，小程序属于微信公众平台，同一个平台下还有微信公众号：在技术角度上，小程序与微信的关系比公众号更密切，因为公众号的文章本质上是一个 H5 网页，对微信底层的依赖比小程序弱；从产品角度上，二者与微信的关系一致，都是运行在微信平台上的第三方应用。

既然小程序是微信平台的第三方应用，那么在接入微信登录时就要严格遵守官方的接入规范。**而在互联网技术领域，对于支持第三方应用接入的平台，在登录授权上有一套标准的技术规范：OAuth 2.0**。

关于OAuth/OAuth2.0，可通过阅读[OAutho原理](https://github.com/hoanFir/blogs/blob/master/%E5%B7%A5%E7%A8%8B/OAuth%E5%8E%9F%E7%90%86.md)学习。

> OAuth2.0解决了一个问题：小A向小B借了东西忘了还，某天小B着急要用，但是小A不在家，但好在小A家的门锁是智能门锁，可以将密码告诉小B让他自己去小A=家里取。但是小A本着“防人之心不可无”的心理，担心小B是否会趁机记下甚至修改你家的门锁密码。左右为难的时候，小A突然想起来智能门锁可以创建临时密码，这种临时密码只能在 10 分钟之内有效，而且没有修改原本密码的权限。这样就解决了被其他人入室的安全问题。简单概括就是：OAuth 2.0是一个授权机制，资源所有者告诉认证服务器，临时授予某个第三方应用访问资源服务器获取资源的权限，认证服务器给第三方应用颁发一个临时令牌，拥有这个令牌便可以获取资源数据，一旦令牌过期或失效便收回权限。



## 二、小程序登录流程

开发小程序的时候，都会涉及到小程序token，而 OAuth 2.0 规范中的令牌，与**小程序登录场景下的 token**作用是一致的，只不过 OAuth 规范只定义了令牌的作用，并没有限制它的具体使用方法，那微信（认证服务器）是怎么实现让用户（资源所有者）授权后使得微信小程序（第三方应用）可以访问用户放在微信服务器（资源服务器）上的用户信息呢？即微信遵循 OAuth 规范前提下的具体实践是什么？

### 2.1 使用微信登录的优势

小程序并没有强制要求只能使用微信登录，开发者完全可以跟 Web 网站一样使用用户名、邮箱等登录方式。但是使用微信登录的优势非常明显：

- 从生态系统的角度上， 相对于其他应用端，以微信为入口的小程序最大的优势是拥有微信完善的生态系统，用户使用微信登录后可以使用微信提供给小程序的各种平台级能力，比如订阅消息、微信支付等。

- 从用户体验的角度上， 用户能够很大程度上降低登录的复杂程度。想象一下，对比在小程序内用用户名密码登录和一键微信登录，哪种方式更容易被用户接受呢？结果不言而喻。

- 从产品策略的角度上， 使用微信登录小程序能够根据用户的来源，制定特殊的产品策略，比如对于小程序的用户发放专属的优惠券。

所以，你可以由此得出小程序使用微信登录的三个主要优势：融入微信生态；提高用户体验；制定产品策略。


### 2.2 小程序登录具体实践
