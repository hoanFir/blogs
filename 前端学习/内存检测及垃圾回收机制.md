🐾 内存检测及垃圾回收机制

🕘 2020.01.07 由 hoanfirst 编辑


### 内存检测

如何检测我们的内存占用？首先可以通过 chrome 中 Memory 来进行内存检测及分析。

使用内存检测的方式参见：

https://developers.google.com/web/tools/chrome-devtools/memory-problems/heap-snapshots?hl=zh-cn


### 垃圾回收机制

JavaScript 语言并不像诸如 C++ 一样需要手动管理内存，如分配和释放，而是有自己一套动态 GC 策略。

JavaScript 是一种拥有**自动垃圾回收**的高级语言，往往拥有这种功能的语言都拥有相对应的虚拟机，如 Java 的jvm，C# 的clr，PHP 的zend，这些虚拟机实现了代码解析、内存管理和自动垃圾回收等功能，而像 C 或 C++ 这种没有虚拟机的语言，需要手动管理内存，但是优势就是编译后可以直接运行而无需虚拟机。

浏览器的标记实现通常有两种策略，即**标记清除法（mark-and-sweep）**，和**引用计数法（reference-counting）**。


1. 标记清除法

解决循环引用的问题：https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Memory_Management#垃圾回收


2. 引用计数法

注意，如果在使用引用计数策略的时候，产生了`循环引用`的问题，就会产生大量内存得不到回收，唯一的办法是手工设置null。



最后，**JavaScript垃圾回收器没有暴露任何接口，因此不能强迫进行垃圾回收，也无法干预内存管理**。


### NodeJS内存管理和垃圾回收机制

对于前端开发，垃圾回收机制了解的不用很多，但对于运行于服务器上的NodeJS，就有必要深入研究和总结运用了。

因为，在浏览器中，V8引擎一个实例的生命周期不会很长，一个页面往往过不久就会被关闭，在关闭页面时内存都会被释放。如果不幸发生内存泄露等问题，仅仅会影响到一个终端用户，而且刷新就行了。因此几乎没有太多管理的必要。但如果是在服务器端，就需要关注内存问题了，因为服务器端对资源的敏感性是很高的，一旦业务规模增大，小小的内存泄漏会造成服务器瘫痪。所以现在如果要在服务器端进行JavaScript开发就需要熟悉v8的内存管理模式和自动垃圾回收机制了。

https://www.jianshu.com/p/bdcf92351f39
