## 1. 初始阶段🌟🌟🌟

初始阶段的小型系统，其特征表现为应用程序，数据库，文件等所有资源都部署在一台服务器上。

![](https://github.com/hoanFir/blogs/blob/master/%E5%B7%A5%E7%A8%8B/images/%E6%88%AA%E5%B1%8F2020-03-26%E4%B8%8B%E5%8D%882.16.36.png?raw=true)


## 2. 应用服务和数据服务分离

随着系统访问量增加，单台服务器的压力在高峰期会上升到很高。

对于上述问题，可以考虑将应用程序、数据库和文件分别部署在独立的服务器上，从而改善并发处理能力和数据存储空间能力。

![](https://github.com/hoanFir/blogs/blob/master/%E5%B7%A5%E7%A8%8B/images/%E6%88%AA%E5%B1%8F2020-03-26%E4%B8%8B%E5%8D%882.16.44.png?raw=true)


## 3. 使用缓存（数据）改善性能

为了进一步提升性能，可以将数据库中访问较集中的一部分数据存储在缓存服务器上，从而减少对数据库的访问次数。访问可以遵循二八定律，即80%的业务访问集中在20%的数据上。

缓存可分为服务器本地缓存和远程分布式缓存。前者访问速度更快但容量有限，且存在与应用程序争用内存的情况。

![](https://github.com/hoanFir/blogs/blob/master/%E5%B7%A5%E7%A8%8B/images/%E6%88%AA%E5%B1%8F2020-03-26%E4%B8%8B%E5%8D%882.16.50.png?raw=true)


## 4. 使用应用服务器集群

当发现系统的访问又开始有变慢的趋势，检查后可以发现应用服务器那里阻塞了很多请求，这种问题是由于并发请求数过高，导致需要排队等待，响应速度变慢。

为了解决单台应用服务器处理能力的问题，可以使用服务器集群。集群是系统解决高并发、海量数据问题的常用手段。

实现方案：通过负载均衡调度服务器，向客户端提供服务，在接收到客户端发来的请求时，负载均衡调度服务器会将请求转发到指定某个应用服务器进行处理。

![](https://github.com/hoanFir/blogs/blob/master/%E5%B7%A5%E7%A8%8B/images/%E6%88%AA%E5%B1%8F2020-03-26%E4%B8%8B%E5%8D%882.16.57.png?raw=true)


## 5. 数据库读写分离

经过一段时间，会发现系统又开始变慢了。经过检查，会发现数据库写入、更新、删除这些操作的数据库连接的资源竞争非常激烈。

为了解决单台数据库服务器处理能力的问题，同样可以使用集群。不过注意，这里的集群一般只分两三个数据库服务器，比如主数据库服务器提供写操作，从数据库服务器提供读操作。

![](https://github.com/hoanFir/blogs/blob/master/%E5%B7%A5%E7%A8%8B/images/%E6%88%AA%E5%B1%8F2020-03-26%E4%B8%8B%E5%8D%882.17.03.png?raw=true)


## 6. 反向代理和cdn加速🌟🌟🌟

考虑到复杂的网络环境和不同地区用户的访问，可以采用CDN和反向代理加快用户访问速度，同时减轻后端应用服务器的负载压力。

cdn和反向代理的基本原理都是缓存。反向代理一般使用 Nginx。

![](https://github.com/hoanFir/blogs/blob/master/%E5%B7%A5%E7%A8%8B/images/%E6%88%AA%E5%B1%8F2020-03-26%E4%B8%8B%E5%8D%882.17.08.png?raw=true)


## 7. 分布式文件系统和分布式数据库

随着系统的不断运行，数据量开始大幅度增长，这个时候可以发现访问仍然会有些慢。所以前面采用的数据库读写分离，随着业务的发展最终也无法满足发型系统的需求。

这时候可以采用分布式数据和分布式文件系统的方案。

分布式数据库，是数据库拆分的最后方法，只有在单表数据规模非常庞大的时候才使用——分表。tips：更常用的数据库拆分方法是业务分库，即将不同的业务数据库部署在不同的服务器上。

在这种架构下，应用服务需要通过一个统一数据访问模块来访问分布式数据库、分布式文件系统和远程分布式缓存，减轻应用服务管理诸多数据源的压力。

![](https://github.com/hoanFir/blogs/blob/master/%E5%B7%A5%E7%A8%8B/images/%E6%88%AA%E5%B1%8F2020-03-26%E4%B8%8B%E5%8D%882.17.13.png?raw=true)


## 8. 使用nosql和搜索引擎

随着业务越来越复杂，对数据存储和检索的需求也越来越复杂。系统需要采用一些非关系型数据库如NoSQL和分数据库查询技术如搜索引擎。

![](https://github.com/hoanFir/blogs/blob/master/%E5%B7%A5%E7%A8%8B/images/%E6%88%AA%E5%B1%8F2020-03-26%E4%B8%8B%E5%8D%882.17.18.png?raw=true)

## 9. 实现业务拆分

将业务进行拆分改造，分别部署在不同服务器集群上。

将整个系统业务分成不同的产品线，应用之间可以通过超链接建立关系，或通过消息队列进行数据分发，当然更多的还是通过访问同一个数据存储系统来构成一个关联的完整系统。

业务拆分可以分为纵向拆分和横向拆分：

- 纵向拆分

将一个大应用拆分为多个小应用， 如果新业务较为独立，那么就直接将其部署为一个独立的Web应用系统。纵向拆分相对简单，通过梳理业务将较少相关的业务剥离即可。

- 横向拆分

主要是将复用的业务独立出来，其他或新增业务只需要调用这些复用服务提供的接口即可。横向拆分需要注意规范服务依赖关系。

![](https://github.com/hoanFir/blogs/blob/master/%E5%B7%A5%E7%A8%8B/images/%E6%88%AA%E5%B1%8F2020-03-26%E4%B8%8B%E5%8D%882.17.22.png?raw=true)


## 10. 分布式服务

随着业务越拆越小，应用系统整体复杂度会呈指数级上升。由于所有应用要和所有数据库系统连接，最终会导致数据库连接资源不足，拒绝服务。

这时需要把公共的应用模块提取出来，部署在分布式服务器上，供应用服务器调用。

![](https://github.com/hoanFir/blogs/blob/master/%E5%B7%A5%E7%A8%8B/images/%E6%88%AA%E5%B1%8F2020-03-26%E4%B8%8B%E5%8D%882.17.27.png?raw=true)
