
糟糕的网站性能是导致用户体验不流畅的主要原因之一。

性能测试，衡量的是影响用户使用网站的流畅程度的关键指标，包括页面大小、请求数量、 首字节时间(time to first byte，TTFB)、加载时间和滚动性能等。

# 一、制定性能预算

制定性能预算指为每个关键指标设定目标值。

在所有代码合并或部署之前持续测试这些指标，若有任何一个指标没通过测试，则需要调整新增的功能，或删除一些其他功能。

制定性能预算的第一种方法：

参考竞争对手，做到比对手更好，保证指标能领先竞争对手 20% 甚至更多。并且要知道，优化关键指标并不能一劳永逸，它需要的是持续监控。可以确定的是，你的竞争对手也正在寻找方法来改善和优化他们自己的网站。

制定性能预算的第二种方法：

参考行业平均水准和通用的最佳实例。[HTTPArchive](http://httparchive.org/)测试并记录了几十万个网站的各种性能指标。当然，保证指标领先行业平均水准的 20% 甚至更多。


# 二、指标


## 2.1 最基本的指标

网站性能最基本的测试是看渲染页面所需要的资源，包括这些资源的大小和总数。

### 2.1.1 页面大小

- 过多大图片

- 过多自定义字体

在项目里使用多种不同字体、过多图标字体（可以考虑使用内联svg代替）

- 压缩代码和文件

通过打包工具压缩代码、在服务器将文件发送到浏览器之前使用 gzip 压缩

- ...


### 2.1.2 请求数量

浏览器对 HTTP 请求的次数有单域名并发限制，所以大量单独的文件意味着浏览器必须进行多轮并发请求。在速度较慢的网络环境中，这么多并发请求会造成很复杂的影响。

- 将资源分布到不同的服务器（或者CDN）

解决单域名并发限制，浏览器可以单次并发并发下载更多的资源

- 将多个单独文件合并到一个文件中

如把数十个 .css 和 .js 文件合并到一个文件中

- 合并多个单独的图像文件

如合并成一个图像映射或者图标字体，使用 Compass 和 Grunt/Gulp 插件可以自动化地完成这些任务

- 动态加载非首页必须资源

进行 code split

- ...


## 2.2、时间指标

### 2.2.1 首字节时间

首字节时间是指从浏览器请求网站页面开始，到浏览器接收到第一个字节之间的毫秒数。这个数值用来测量浏览器和服务器之间的连通路径，包括 DNS 查询、初始连接和数据接收。



### 2.2.2 开始渲染时间

比“首字节时间”更有价值的是“开始渲染时间”。指用户开始在页面上看到内容的 时间。这意味着所有阻塞渲染的文件都已经加载完成，浏览器已经开始渲染文档模型 了。可以通过以下方式优化开始渲染时间：延迟加载阻塞渲染的 JavaScript 和 CSS 文件、将关键的 CSS 代码内联到页面头部、用数据 URI （如base64）代替图片资源，以及动态加载所有在文档模型渲染完成后才下载的资源。


### 2.2.3 文档完成时间

只要最初请求的资源已经加载成功，就可以认为文档“完成”了。文档完成时间不包括 JavaScript 中拉取资源消耗的时间，因此延迟加载的资源不会影响这个指标。



## 2.3、混合度量的综合指标

一些根据多个性能指标综合考虑的指标。

### 2.3.1 PageSpeed

PageSpeed(https://developers.google.com/speed/pagespeed/insights/) 是 Google 开 发 的 网 站 工具和 Chrome 浏览器的扩展程序，用来分析站点的性能和网站的可用性，它给出一个用 百分比表示的分数，并解释了提高分数的方法。

测试包括：

- 是否存在阻塞渲染的 JavaScript 或者 CSS

- 重定向至登陆页

- 图片优化

- 文件压缩

- 服务器响应时间

- 服务器端压缩

- 浏览器端缓存

- 点击目标的大小

- 窗口可见区域的配置

- 清晰的字体大小


### 2.3.2 SpeedIndex

Speed Index(https://sites.google.com/a/webpagetest. org/docs/using-webpagetest/metrics/speed-index)指的是页面可见部分展示完成的平均时间， 该指标通过用毫秒表示，并取决于视图端口的大小。

Speed Index 是度量终端用户实际体验的最好标准之一。
